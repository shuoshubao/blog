<!doctype html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="硕鼠宝,shuoshubao,shubao,FE,html5,css3,js,jquery,jq" name="description"><meta content="硕鼠宝,shuoshubao,shubao,FE,html5,css3,js,jquery,jq" name="keywords"><link href="favicon.ico" rel="shortcut icon"><title>WEB前端开发 - 前端code-review经验总结</title><style>*,:after,:before{box-sizing:border-box}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-thumb{border-radius:4px;background-color:rgba(0,0,0,.2);box-shadow:inset 1px 1px 0 rgba(0,0,0,.1),inset 0 -1px 0 rgba(0,0,0,.07)}::-webkit-scrollbar:horizontal{height:8px}::-webkit-scrollbar-thumb:horizontal{border-radius:4px;background:#666}html{height:100%;font-size:20px;-webkit-touch-callout:none;-webkit-text-size-adjust:100%;-webkit-overflow-scrolling:touch;-webkit-tap-highlight-color:transparent}body{margin:0;min-height:100%;color:#000;font:14px/1.5 arial;position:relative}b,strong{font-weight:700}em,i,var{font-style:normal}.hljs-comment,.hljs-emphasis,.hljs-quote,.markdown blockquote,.markdown dl dt,.markdown em{font-style:italic}img{border:0;vertical-align:middle}dd,dl,form{margin:0}button,input,select,textarea{margin:0;padding:0 5px;height:30px;outline:0;border:1px solid #ccc;border-radius:4px;background-color:#fff;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);vertical-align:baseline;font-size:100%;line-height:normal}input[type=email]:focus,input[type=password]:focus,input[type=text]:focus,textarea:focus{outline:0;border-color:#66afe9;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 3px rgba(102,175,233,.6)}select{background-color:#fff}button,html input[type=button],input[type=submit]{cursor:pointer;-webkit-appearance:button}input[type=checkbox],input[type=radio]{padding:0;height:13px}textarea{overflow:auto;padding:5px;width:100%;vertical-align:top;resize:none}table{width:100%;border-collapse:collapse;border-spacing:0}td{padding:0}th{padding:0;text-align:left;font-weight:400}h1,h2,h3,h4,h5,h6,p{margin:0;font-weight:400;font-size:100%}ol,ul{margin:0;padding:0;list-style:none}a{color:inherit;text-decoration:none}a:active,a:hover,a:link,a:visited{outline:0;color:#26c6da;text-decoration:none}.show{display:block}.hide{display:none}.markdown blockquote{margin:0;color:#828282;border-left:4px solid #05a5d1;background-color:#f5f5f5;padding:5px 10px;font-size:14px}.markdown blockquote p{margin:0!important}.markdown h1,.markdown h2,.markdown h3,.markdown h4,.markdown h5,.markdown h6,.markdown p{margin:10px 0;padding:0}.markdown h1{font-size:28px;color:#000}.markdown h2{font-size:24px;border-bottom:1px solid #ccc;color:#000}.markdown h3{font-size:18px}.markdown h4{font-size:16px}.markdown dl dt,.markdown h5,.markdown h6{font-size:14px}.markdown h6{color:#777}.markdown h1+p,.markdown h2+p,.markdown h3+p,.markdown h4+p,.markdown h5+p,.markdown h6+p{margin-top:10px}.markdown a{text-decoration:none;color:#4183c4}.markdown a:hover{text-decoration:underline}.markdown ul{padding-left:15px;line-height:30px;list-style:disc}.markdown ol{padding-left:30px;list-style:decimal}.markdown dl,.markdown dl dt,.markdown dl dt:first-child{padding:0}.markdown ol li ol:first-of-type,.markdown ol li ul:first-of-type,.markdown ul li ol:first-of-type,.markdown ul li ul:first-of-type{margin-top:0}.markdown ol ol,.markdown ol ul,.markdown ul ol,.markdown ul ul{margin-bottom:0}.markdown dl dt{margin:15px 0 5px}.markdown dl dd{margin:0 0 15px;padding:0 15px}.markdown hr{clear:both;overflow:hidden;height:0;margin:15px 0;padding:0;border:none;border-bottom:4px solid #ddd;background:0 0}.markdown table+table{margin-top:10px}.markdown table th{font-weight:700}.markdown table td,.markdown table th{padding:6px 13px;border:1px solid #ccc}.hljs,.p-nav a{border:1px solid #ddd}.markdown thead tr{background-color:#f0f0f0}.markdown tbody tr:hover{background-color:#f8f8f8}.hljs{display:block;overflow-x:auto;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-meta,.hljs-strong,.p-about dt{font-weight:700}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs{line-height:18px;overflow:auto;padding:10px;transition:border-color .2s;border-radius:3px;background-color:#fff;box-shadow:inset 0 0 3px rgba(2,128,174,.3)}.hljs tr:hover td{background-color:transparent}.hljs td{height:20px;padding:0!important;border:none!important}.hljs td:first-child{width:20px;text-align:right;color:rgba(27,31,35,.3);padding:0 10px!important}.hljs td:first-child:before{content:attr(data-line-number)}.hljs:hover{border-color:#0280ae;box-shadow:0 0 5px 0 rgba(0,0,0,.4)}.hljs,.hljs code{font-family:Consolas,&#39}.hljs code{margin:0;padding:1px 3px;color:#555;border:none;background:0 0;background-color:rgba(0,0,0,.04)}.hljs table{display:table}body{height:auto!important}.nav{height:50px}.nav .inner{position:fixed;z-index:100;top:0;right:0;left:0;font-size:16px;line-height:50px;background-color:#f5f5f5;border-bottom:1px solid #e5e5e5}.nav .wrap{margin-left:auto;margin-right:auto;padding-left:10px;padding-right:10px}.nav .wrap:after{content:&#39;clear:both}@media (min-width:1000px){.nav .wrap{width:1000px}}@media (min-width:1200px){.nav .wrap{width:1200px}}@media (min-width:1600px){.nav .wrap{width:1500px}}.nav .home{float:left;line-height:50px}.nav .home .logo{float:left;width:30px;height:30px;position:relative;top:10px}.nav .home .name{float:left;margin-left:5px;font-size:20px}.nav ul{float:left;margin-left:20px}.nav li{float:left}.nav li.active a{color:#26c6da}.nav li a{display:block;padding:0 15px;cursor:pointer}.nav a{color:#333}.nav a.active,.nav a:hover{color:#26c6da}.nav .github{float:right;padding:0 10px}@media (max-width:1000px){.nav .inner{background-color:#fff;line-height:40px;box-shadow:inset 0 -1px 0 #e9e9e9,0 1px 0 rgba(0,0,0,.05)}.nav .wrap{padding:0}.nav .home{margin-left:10px}.nav .navbar{position:absolute;right:5px;top:5px;width:40px;height:40px;padding:9px;border:1px solid #e5e5e5;cursor:pointer}.nav .navbar.active{border-color:#0aa284}.nav .navbar .bar{display:block;width:18px;height:2px;margin-right:0;background-color:#333;border-radius:1px}.nav li,.nav ul{width:100%}.nav .navbar .bar:not(:first-child){margin-top:3px}.nav .github{display:none}.nav ul{margin-left:0;height:0;overflow:hidden;transition:height .4s linear}.nav ul.active{padding:10px;height:auto}.nav li.active a,.nav li:hover a{color:#26c6da}.nav li a{color:#555;padding:0 10px}}.content:after,.footer .wrap:after{content:&#39;clear:both}.content,.footer .wrap{margin-left:auto;margin-right:auto}.content{padding:10px}@media (min-width:1000px){.content{width:1000px}}@media (min-width:1200px){.content{width:1200px}}@media (min-width:1600px){.content{width:1500px}}.list{line-height:40px;color:#26c6da}.list li{overflow:hidden}.list .title{float:left}.list .time{float:right}.footer{height:101px;color:#666}.footer .outer{position:absolute;bottom:0;left:0;width:100%;padding:15px 10px;border-top:1px solid #ddd;background-color:#f5f5f5}.footer .wrap{padding-left:10px;padding-right:10px}@media (min-width:1000px){.footer .wrap{width:1000px}}@media (min-width:1200px){.footer .wrap{width:1200px}}@media (min-width:1600px){.footer .wrap{width:1500px}}.footer a{color:#6cc}.p-nav{padding:10px}.p-nav dl:not(:first-child){margin-top:10px}.p-nav dd{overflow:hidden;margin:0 -10px;padding-bottom:5px}.p-nav a{float:left;text-align:center;line-height:28px;padding:0 20px;margin:10px 5px 0;border-radius:3px;transition:all .4s linear}.p-nav a:hover{border-color:#26c6da;color:#333;box-shadow:inset 0 0 3px #26c6da}.p-about{padding:10px}.p-about dl{overflow:hidden}.p-about dl:not(:first-child){margin-top:10px}.p-about dt{float:left;width:100px;text-align:right;padding-right:20px}.p-about dd{margin-left:100px}</style></head><body><nav class="nav"><div class="inner"><div class="wrap"><a href="/blog/index/index.html" class="home"><svg aria-hidden="true" class="logo" height="30" version="1.1" viewBox="0 0 16 16" width="30"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg><span class="name">硕鼠宝</span></a><ul><li><a href="/blog/index/index.html">Home</a></li><li><a href="/blog/html/index.html">HTML</a></li><li><a href="/blog/css/index.html">CSS</a></li><li><a href="/blog/js/index.html">JS</a></li><li><a href="/blog/node/index.html">Node</a></li><li><a href="/blog/tool/index.html">Tool</a></li><li class="active"><a href="/blog/assemble/index.html">Assemble</a></li></ul><a href="https://github.com/shuoshubao/shuoshubao.github.io/" rel="noopener noreferrer" target="_blank" class="github">GitHub</a></div></div></nav><article class="content"><div class="markdown"><h2>背景</h2><p>最近一段时间，一直在跟进团队里同学发起的 code-review，针对每个 review 都提了不少可以优化的建议。在这个过程中发现一些在每次 review 基本都会出现的通用问题，现整理成文档的形式供大家阅读，希望大家能从中有所收获，从而在各自的业务项目中能提高代码的<strong>可读性</strong>和可维护性。</p><p>可读性差的代码虽然很多，但是究其原因，还是可以进行以下简单的分类：</p><ul><li>js-api 的使用</li><li>js 语法相关</li><li>jsx 相关的问题</li><li>工具库的使用</li><li>js 设计的糟粕</li></ul><h2>js-api 的使用</h2><h3>indexOf 与 includes</h3><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>colums.indexOf(item) === <span class="hljs-number">-1</span> ? colums.concat(item) : colums;</td></tr><tr><td>2</td><td></td></tr><tr><td>3</td><td><span class="hljs-keyword">if</span> (piLiangChuLiDaiBanDict.indexOf(taskKey) !== <span class="hljs-number">-1</span>) {}</td></tr><tr><td>4</td><td></td></tr><tr><td>5</td><td><span class="hljs-keyword">const</span> isNewListPage = newListPageCitys.indexOf(<span class="hljs-built_in">window</span>._GLOBAL_DATA_.CITY) &gt; <span class="hljs-number">-1</span>;</td></tr><tr><td>6</td><td></td></tr><tr><td>7</td><td><span class="hljs-keyword">if</span> (<span class="hljs-string">`<span class="hljs-subst">${address[<span class="hljs-number">3</span>]}</span>`</span>.indexOf(<span class="hljs-string">'层'</span>) &lt; <span class="hljs-number">0</span>) {}</td></tr><tr><td>8</td><td></td></tr><tr><td>9</td><td><span class="hljs-keyword">if</span> (inComplexRole.indexOf(item.name) &gt; <span class="hljs-number">0</span>) {}</td></tr><tr><td>10</td><td></td></tr><tr><td>11</td><td>&lt;div disabled={[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>].indexOf(contractStatus) &gt;= <span class="hljs-number">0</span>} /&gt;</td></tr><tr><td>12</td><td></td></tr><tr><td>13</td><td><span class="hljs-keyword">if</span> (<span class="hljs-regexp">/税/</span>.test(qiItem.NAME) {}</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>&lt;div disabled={[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>].includes(contractStatus)} /&gt;;</td></tr><tr><td>2</td><td></td></tr><tr><td>3</td><td><span class="hljs-keyword">if</span> (qiItem.NAME.includes(<span class="hljs-string">'税'</span>)) {</td></tr><tr><td>4</td><td>}</td></tr></tbody></table></pre><blockquote><p>在同一个项目中, indexOf 的所有用法基本齐全了~ 其实做的事情就是判断数组或字符串是否包含子项。而这个功能早就在 es6 和 es7 中有标准的 api 来实现，即<strong>String.prototype.includes</strong>和<strong>Array.prototype.includes</strong></p></blockquote><p>indexOf 的本意是返回子项在数组或字符串中第一次出现的索引值, 而 -1 只是一个特殊值，表示不存在。而 includes 则直接返回一个布尔值，表示是否包含子项。</p><h3>find 和 filter</h3><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> { label } = (reallyOptions || []).filter(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.value == val)[<span class="hljs-number">0</span>];</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> { label } = (reallyOptions || []).find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.value == val);</td></tr></tbody></table></pre><p>当你需要的是过滤的所有项时，应使用 filter, 而 find 就是 filter[0] 的快捷方式。当然两者还有其他区别，这里不展开讲。</p><h3>map 和 forEach</h3><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> options = [];</td></tr><tr><td>2</td><td>daiban.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {</td></tr><tr><td>3</td><td>    options.push({ <span class="hljs-attr">value</span>: item, <span class="hljs-attr">label</span>: item.taskDescription });</td></tr><tr><td>4</td><td>});</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> options = [];</td></tr><tr><td>2</td><td>daiban.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {</td></tr><tr><td>3</td><td>    options.push({ <span class="hljs-attr">value</span>: item, <span class="hljs-attr">label</span>: item.taskDescription });</td></tr><tr><td>4</td><td>});</td></tr><tr><td>5</td><td></td></tr><tr><td>6</td><td><span class="hljs-comment">// 当然，这样写才是最好的</span></td></tr><tr><td>7</td><td><span class="hljs-keyword">const</span> options = daiban.map(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {</td></tr><tr><td>8</td><td>    <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: item, <span class="hljs-attr">label</span>: item.taskDescription };</td></tr><tr><td>9</td><td>});</td></tr></tbody></table></pre><p>map 和 forEach 的作用非常相似, 但区别也很明显。当迭代器里的代码有返回值时, 应使用 map, 否则应使用 forEach。</p><p>map 可以理解为 初始值 + forEach + push 的结合体。</p><h2>js 语法相关</h2><h3>条件语句里写非常长的代码</h3><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">if</span> (</td></tr><tr><td>2</td><td>    <span class="hljs-keyword">this</span>.state.buyer &amp;&amp;</td></tr><tr><td>3</td><td>    <span class="hljs-keyword">this</span>.state.buyer.length &amp;&amp;</td></tr><tr><td>4</td><td>    <span class="hljs-keyword">this</span>.state.seller &amp;&amp;</td></tr><tr><td>5</td><td>    <span class="hljs-keyword">this</span>.state.seller.length &amp;&amp;</td></tr><tr><td>6</td><td>    <span class="hljs-keyword">this</span>.state.participants &amp;&amp;</td></tr><tr><td>7</td><td>    <span class="hljs-keyword">this</span>.state.participants.length</td></tr><tr><td>8</td><td>) {</td></tr><tr><td>9</td><td>    <span class="hljs-comment">// code</span></td></tr><tr><td>10</td><td>}</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> { buyer, seller, participants } = <span class="hljs-keyword">this</span>.state;</td></tr><tr><td>2</td><td><span class="hljs-keyword">const</span> isValidate = [buyer, seller, participants].every(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v &amp;&amp; v.length);</td></tr><tr><td>3</td><td><span class="hljs-keyword">if</span> (isValidate) {</td></tr><tr><td>4</td><td>    <span class="hljs-comment">// code</span></td></tr><tr><td>5</td><td>}</td></tr></tbody></table></pre><blockquote><p>问题: 没有利用解构；大量的重复逻辑，条件语句过长可读性差</p></blockquote><blockquote><p>这种写法其实随处可见，源自于万恶的复制粘贴的习惯。一般来说，使用解构和数组的 some 或者 every 就可以解决问题。</p></blockquote><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>!op.noTips &amp;&amp; Toast.offline(data.msg || <span class="hljs-string">'数据请求异常'</span>, <span class="hljs-number">2</span>);</td></tr><tr><td>2</td><td>op.noTips &amp;&amp; Toast.hide();</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">if</span> (op.noTips) {</td></tr><tr><td>2</td><td>    Toast.hide();</td></tr><tr><td>3</td><td>} <span class="hljs-keyword">else</span> {</td></tr><tr><td>4</td><td>    Toast.offline(data.msg || <span class="hljs-string">'数据请求异常'</span>, <span class="hljs-number">2</span>);</td></tr><tr><td>5</td><td>}</td></tr></tbody></table></pre><blockquote><p>上述代码要表达的意思其实就是<strong>if</strong>做的事情，如果都这么写，是否就不需要<strong>if</strong>语句了？<strong>&amp;&amp;</strong>、<strong>||</strong>、<strong>? :</strong>是完全可以取代<strong>if</strong>的。压缩代码量这种事就交给 webpack terser 这些工具处理吧, 我们要写的是可读性高的代码！</p></blockquote><h3>三目嵌套三目</h3><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> backgroundImageUrl = item.avatar || (item.sex ? (item.sex == <span class="hljs-string">'F'</span> ? Female : Male) : Male);</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> { avatar, sex } = item;</td></tr><tr><td>2</td><td><span class="hljs-keyword">let</span> backgroundImageUrl = avatar;</td></tr><tr><td>3</td><td><span class="hljs-keyword">if</span> (!avatar) {</td></tr><tr><td>4</td><td>    <span class="hljs-keyword">if</span> (sex) {</td></tr><tr><td>5</td><td>        backgroundImageUrl = sex == <span class="hljs-string">'F'</span> ? Female : Male;</td></tr><tr><td>6</td><td>    } <span class="hljs-keyword">else</span> {</td></tr><tr><td>7</td><td>        backgroundImageUrl = Male;</td></tr><tr><td>8</td><td>    }</td></tr><tr><td>9</td><td>}</td></tr></tbody></table></pre><blockquote><p>这里明显可以看出, 优化后的代码在体积上显著增加了，请感受下两段代码之间可读性的差异。</p></blockquote><h2>jsx 相关的问题</h2><h3>三目与 jsx 语法结合使用</h3><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">const</span> AllInfo =</td></tr><tr><td>2</td><td>    hasInfo &amp;&amp; allMessahe ? (</td></tr><tr><td>3</td><td>        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"all-info"</span>&gt;</span></span></td></tr><tr><td>4</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{Sigh}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"icon"</span> /&gt;</span></td></tr><tr><td>5</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{allMessahe}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></td></tr><tr><td>6</td><td>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>7</td><td>    ) : null;</td></tr><tr><td>8</td><td></td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">let</span> allInfo = <span class="hljs-literal">null</span>;</td></tr><tr><td>2</td><td><span class="hljs-keyword">if</span> (hasInfo &amp;&amp; allMessahe) {</td></tr><tr><td>3</td><td>    allInfo = (</td></tr><tr><td>4</td><td>        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"all-info"</span>&gt;</span></span></td></tr><tr><td>5</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{Sigh}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"icon"</span> /&gt;</span></td></tr><tr><td>6</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{allMessahe}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></td></tr><tr><td>7</td><td>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>8</td><td>    );</td></tr><tr><td>9</td><td>}</td></tr><tr><td>10</td><td></td></tr></tbody></table></pre><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>{</td></tr><tr><td>2</td><td>    appAuditStatus == <span class="hljs-number">1</span> &amp;&amp; message ? (</td></tr><tr><td>3</td><td>        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">styleName</span>=<span class="hljs-string">"messageContainer"</span>&gt;</span></span></td></tr><tr><td>4</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">styleName</span>=<span class="hljs-string">"iconContainer"</span>&gt;</span></td></tr><tr><td>5</td><td>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>!<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></td></tr><tr><td>6</td><td>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>7</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">styleName</span>=<span class="hljs-string">"reasonContainer"</span>&gt;</span></td></tr><tr><td>8</td><td>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>不通过：{message}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></td></tr><tr><td>9</td><td>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>10</td><td>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>11</td><td>    ) : <span class="hljs-literal">null</span>;</td></tr><tr><td>12</td><td>}</td></tr></tbody></table></pre><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>{</td></tr><tr><td>2</td><td>    appAuditStatus == <span class="hljs-number">1</span> &amp;&amp; message &amp;&amp; (</td></tr><tr><td>3</td><td>        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">styleName</span>=<span class="hljs-string">"messageContainer"</span>&gt;</span></span></td></tr><tr><td>4</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">styleName</span>=<span class="hljs-string">"iconContainer"</span>&gt;</span></td></tr><tr><td>5</td><td>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>!<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></td></tr><tr><td>6</td><td>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>7</td><td>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">styleName</span>=<span class="hljs-string">"reasonContainer"</span>&gt;</span></td></tr><tr><td>8</td><td>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>不通过：{message}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></td></tr><tr><td>9</td><td>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>10</td><td>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></td></tr><tr><td>11</td><td>    );</td></tr><tr><td>12</td><td>}</td></tr></tbody></table></pre><blockquote><p>当三目与 jsx 结合使用时，代码整体看起来非常臃肿。建议三目只用于非常简单的逻辑运算，具体来说最好是只有一行代码。</p></blockquote><h3>map 与 jsx 的结合使用</h3><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>{</td></tr><tr><td>2</td><td>    data &amp;&amp; data.length</td></tr><tr><td>3</td><td>        ? data.map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {</td></tr><tr><td>4</td><td>              <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;</td></tr><tr><td>5</td><td>          })</td></tr><tr><td>6</td><td>        : <span class="hljs-literal">null</span>;</td></tr><tr><td>7</td><td>}</td></tr><tr><td>8</td><td></td></tr><tr><td>9</td><td><span class="hljs-comment">// 或者这么写</span></td></tr><tr><td>10</td><td>{</td></tr><tr><td>11</td><td>    data &amp;&amp;</td></tr><tr><td>12</td><td>        data.length &amp;&amp;</td></tr><tr><td>13</td><td>        data.map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {</td></tr><tr><td>14</td><td>            <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;</td></tr><tr><td>15</td><td>        });</td></tr><tr><td>16</td><td>}</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>{</td></tr><tr><td>2</td><td>    (data || []).map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {</td></tr><tr><td>3</td><td>        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;</td></tr><tr><td>4</td><td>    });</td></tr><tr><td>5</td><td>}</td></tr></tbody></table></pre><blockquote><p>这个 case 在 react 中非常常见，简单的优化即可让代码更简洁，嵌套少一层，在 jsx 结构复杂时效果更明显。</p></blockquote><h2>工具库的使用</h2><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">this</span>.props.history.push(</td></tr><tr><td>2</td><td>    <span class="hljs-string">`/tradeschedule?businessId=<span class="hljs-subst">${getUrlParam(<span class="hljs-string">'businessId'</span>)}</span>`</span> +</td></tr><tr><td>3</td><td>        <span class="hljs-string">`&amp;eBusinessId=<span class="hljs-subst">${getUrlParam(<span class="hljs-string">'eBusinessId'</span>)}</span>`</span> +</td></tr><tr><td>4</td><td>        <span class="hljs-string">`&amp;ucid=<span class="hljs-subst">${getUrlParam(<span class="hljs-string">'ucid'</span>)}</span>`</span> +</td></tr><tr><td>5</td><td>        <span class="hljs-string">`&amp;roleName=<span class="hljs-subst">${getUrlParam(<span class="hljs-string">'roleName'</span>)}</span>`</span> +</td></tr><tr><td>6</td><td>        <span class="hljs-string">`&amp;docKey=<span class="hljs-subst">${getUrlParam(<span class="hljs-string">'docKey'</span>)}</span>`</span>,</td></tr><tr><td>7</td><td>    { nodeInfo }</td></tr><tr><td>8</td><td>);</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">import</span> { pick } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>;</td></tr><tr><td>2</td><td><span class="hljs-keyword">import</span> { Util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@jiaoyi/tangram'</span>;</td></tr><tr><td>3</td><td></td></tr><tr><td>4</td><td><span class="hljs-keyword">const</span> { getAllUrlParam, stringifyUrl } = Util;</td></tr><tr><td>5</td><td></td></tr><tr><td>6</td><td><span class="hljs-keyword">const</span> params = pick(getAllUrlParam(), [<span class="hljs-string">'businessId'</span>, <span class="hljs-string">'eBusinessId'</span>, <span class="hljs-string">'ucid'</span>, <span class="hljs-string">'roleName'</span>, <span class="hljs-string">'docKey'</span>]);</td></tr><tr><td>7</td><td></td></tr><tr><td>8</td><td><span class="hljs-keyword">this</span>.props.history.push(stringifyUrl(<span class="hljs-string">'/tradeschedule'</span>, params));</td></tr></tbody></table></pre><blockquote><p>字符串拼接参数这种明显属于高频操作，如果团队中没有封装对应的工具函数，写的次数多了也应该想着去封装下，或者给负责工具库的人提需求。</p></blockquote><p><strong>bad-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td>&lt;div styleName={[<span class="hljs-string">'second'</span>, second.disabled ? <span class="hljs-string">'disabled'</span> : <span class="hljs-string">''</span>, second.using ? <span class="hljs-string">'isUsing'</span> : <span class="hljs-string">''</span>].join(<span class="hljs-string">' '</span>)} /&gt;</td></tr></tbody></table></pre><p><strong>good-code</strong></p><pre classname="hljs language-javascript"><table style="border-spacing:0;border-collapse:collapse"><colgroup><col><col></colgroup><thead><tr><th>索引</th><th>内容</th></tr></thead><tbody><tr><td>1</td><td><span class="hljs-keyword">import</span> classnames form <span class="hljs-string">'classnames'</span>;</td></tr><tr><td>2</td><td></td></tr><tr><td>3</td><td><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">styleName</span>=<span class="hljs-string">{classnames(</span>'<span class="hljs-attr">second</span>', { <span class="hljs-attr">disabled:</span> <span class="hljs-attr">second.disabled</span>, <span class="hljs-attr">isUsing:</span> <span class="hljs-attr">second.using</span> })} /&gt;</span></span></td></tr><tr><td>4</td><td></td></tr></tbody></table></pre><blockquote><p>这种 case 在项目中也是非常常见的，做的事情很简单，但需要些冗余的代码。classnames 就是为了解决这个场景的。</p></blockquote><p>lodash, classnames, query-string 等等这些都是非常好用的工具库，在 npm 上都是下载量极高的包，如果还没有用上，是否该反思下自己为什么没有用上。</p><p>另外，负责工具库的同学，也应加深对流行度极高的工具包的推广工作，以及团队工具库提供的能力是否足够丰富，工具库的使用情况和覆盖度等问题。</p><h2>js 语言设计的糟粕</h2><p>JavaScript 作为一门在 7 天内设计成的语言，存在许多糟糕的设计。下面列举的是一些代码风格相关的设计，（其实很多语言在设计之初，为了让更多的程序员使用自己的语言，就兼容各种各样的语法习惯，这或许是作者的无奈之举），比如：</p><ul><li>一条语句，分号是可选的</li><li>if 后面的花括号可缺省</li><li>es6 里的箭头函数<ul><li>参数的括号</li><li>返回值的简写</li></ul></li></ul><p>这一类型的就不举例具体代码了，相信大家都能从文字上理解。</p><h1>总结</h1><p>感谢阅读到这里~ 看完后，可以想下自己是否也正在写着这样的代码，项目中是否也有大量的<code>bad-code</code>。</p><p>以上仅是浓缩版的代码片段，更多内容请移步 wiki 上的总结(仅公司内网可见):<a href="http://wiki.lianjia.com/pages/viewpage.action?pageId=679921171">http://wiki.lianjia.com/pages/viewpage.action?pageId=679921171</a></p><p>针对此次大幅度的代码优化，我整理了下 bad-code 中反应的一些认知误区：</p><ol><li>代码越少，代码就越优雅，代码水平越高</li><li>代码能写在一行就是不能再优化的代码</li><li>代码的写法越生僻，越能体现开发水平高超</li></ol><p>写代码，其实说白了就是在做翻译，先将需求用人类的语音描述清楚，再通过 JavaScript 语言将人类语言翻译成浏览器编译器能识别的代码。在实际工作中，是需要和别的翻译一起协同工作，因此我们翻译的语言，不止要机器能识别，自己能看懂，还要其他同事也能看懂。代码的<strong>可维护性</strong>高于一切。</p><p>另外，我们要相信开源的力量，相信业界标准的力量。<strong>prettier</strong>和<strong>eslint</strong>(以及 airbnb 的各种 eslint 规范)、<strong>sonar</strong>都是非常成熟的工具，能在代码层面分析出我们的代码存在的各种问题，并给出推荐的写法。</p><p>最后，安利下 贝壳-交易 FE 团队 在<strong>prettier+eslint+sonar</strong>方面的沉淀:<a href="https://git.lianjia.com/transaction/fe-tect/-/tree/master/packages/config">@jiaoyi/config</a></p></div></article><footer class="footer"><div class="outer"><div class="wrap"><span>© 2014-2021 Shuoshubao.com 版权所有 京ICP备15042742号</span><span>Powered by</span><a href="https://github.com/shuoshubao/shuoshubao.github.io/" rel="noopener noreferrer" target="_blank">GitHub</a><a href="https://facebook.github.io/react/" rel="noopener noreferrer" target="_blank">React</a></div></div></footer></body></html>